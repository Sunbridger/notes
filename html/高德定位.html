<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    #container {width:100%; height: 400px; }
</style>
<body>
    <div id="container"></div>
    <div id="addres"></div>
    <!-- <script src="https://webapi.amap.com/maps?v=1.4.11&key=630f641631116d89f801a59e462247c6&callback=onLoad"></script> -->
    <script type="text/javascript">
        function addJs(callback) {
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.charset = 'utf-8';
            script.src = 'https://webapi.amap.com/maps?v=1.4.8&key=7258bbb02b5e8ba16d75ed555a959630&callback=onLoad';
            document.getElementsByTagName('head')[0].appendChild(script);
            window.onLoad = callback;
        }
        var geolocation = null;
        var geocoder = null;
        addJs(init);
        function init(x = 120.03488, y = 30.24444){

            AMap.plugin('AMap.Geolocation',function(){//异步加载插件
                geolocation = new AMap.Geolocation({
                    enableHighAccuracy: true,
                    timeout: 800,
                    useNative: true,
                    zoomToAccuracy: true
                });

                map.addControl(geolocation);

                // geolocation.getCurrentPosition((status, result) => {
                //     console.log(result.formattedAddress);
                //     if (status === 'complete') {
                //         addres.innerText = `地址：${result.formattedAddress} \t 维度：${result.position.lng} ${result.position.lat}`;
                //     }
                // });
            });
            AMap.plugin('AMap.Geocoder', () => {
                geocoder = new AMap.Geocoder({
                    city: "010", //城市设为北京，默认：“全国”
                    radius: 1000 //范围，默认：500
                });
                // map.addControl(geocoder);
            })

            var map = new AMap.Map('container', {
                center:[x, y],
                zoom: 11,
                mapStyle: 'amap://styles/whitesmoke',
            });
            // 添加圆圈区域
            var circle = new AMap.Circle({
                center: new AMap.LngLat(x, y),  // 圆心位置
                radius: 3000, // 圆半径
                fillColor: 'rgba(1, 1, 1, .5)',   // 圆形填充颜色
                strokeColor: '#fff', // 描边颜色
                strokeWeight: 1, // 描边宽度
                strokeStyle: 'dashed'
            });
            // 判断是否点在3km之内
            console.log(circle.contains({P: 30.24444, R: 120.03488, lng: 120.03488, lat: 30.23444}), '是否再远点');
            map.add(circle);


            var circleMarker1 = new AMap.CircleMarker({
                center: [120.03488, 30.24444],
                radius: 2,
                strokeColor:'red',
                // strokeWeight:2,
                // strokeOpacity:0.5,
                fillColor:'red',
                // fillOpacity:0.5,
                zIndex:10,
                bubble:true,
                cursor:'pointer',
                clickable: true
            });
            circleMarker1.setMap(map);

            var circleMarker2 = new AMap.CircleMarker({
                center: [120.00018, 30.14444],
                radius: 2,
                strokeColor:'red',
                // strokeWeight:2,
                // strokeOpacity:0.5,
                fillColor:'red',
                // fillOpacity:0.5,
                zIndex:10,
                bubble:true,
                cursor:'pointer',
                clickable: true
            });
            circleMarker2.setMap(map);
            // 添加标记小圆点的
            // var marker1 = new AMap.CircleMarker({
            //     center: new AMap.LngLat(116.35,39.9),
            //     radius: 1
            // });

            // var marker2 = new AMap.CircleMarker({
            //     position: new AMap.LngLat(116.34,39.9),
            //     offset: new AMap.Pixel(-10, -10),
            //     icon: '//vdata.amap.com/icons/b18/1/2.png', // 添加 Icon 图标 URL
            //     title: '北京'
            // });
            // var marker3 = new AMap.CircleMarker({
            //     position: new AMap.LngLat(116.35,39.89),
            //     offset: new AMap.Pixel(-10, -10),
            //     icon: '//vdata.amap.com/icons/b18/1/2.png', // 添加 Icon 图标 URL
            //     title: '北京'
            // });

            // map.add([marker1, marker2, marker3]);

            map.on('click', function(ev) {
                const { lat, lng } = ev.lnglat;

                map.remove([circle, circleMarker1]);

                map.setZoomAndCenter(11, [lng, lat]);

                circleMarker1 = new AMap.Marker({
                    map,
                    position: new AMap.LngLat(lng, lat),
                    // content: 'ii',
                    // offset: new AMap.Pixel(2, 2)
                });
                circle = new AMap.Circle({
                    map,
                    center: new AMap.LngLat(lng, lat),
                    radius: 3000,
                    strokeWeight: 1,
                    fillColor: 'rgba(110, 18, 205, 0.4)',
                    strokeColor: '#3A9BFB',
                    strokeStyle: 'dashed',
                    strokeDasharray: [12, 8],
                    fillOpacity: 0.2,
                    strokeOpacity: 0.6,
                    bubble: true
                });
                geocoder.getAddress([lng, lat], (status, result) => {
                    console.log(result.regeocode.formattedAddress);
                    addres.innerText = `地址：${result.regeocode.formattedAddress}
                     维度：${lng} ${lat}`;
                })
            });
        }

    </script>
</body>
</html>
